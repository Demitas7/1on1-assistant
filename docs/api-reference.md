# 1on1アシスタント API仕様書

## 概要

1on1アシスタントは主にNext.js Server ActionsとREST APIエンドポイントを使用してデータの取得・操作を行います。このドキュメントでは、利用可能なAPIエンドポイントとそのパラメータ、レスポンス形式について説明します。

## 認証

このアプリケーションはローカルデータベースを使用し、認証は実装されていません。APIエンドポイントはローカルホストからのみアクセス可能です。

## 共通レスポンス形式

すべてのAPIエンドポイントは以下の共通形式でレスポンスを返します:

```json
{
  "success": true/false,
  "data": { ... },  // 成功時のレスポンスデータ
  "error": { ... }  // エラー時のエラー情報
}
```

## エラーコード

- `400` - Bad Request: リクエストパラメータが不正
- `404` - Not Found: リソースが見つからない
- `500` - Internal Server Error: サーバー内部エラー

## APIエンドポイント

### メンバー管理

#### メンバー一覧の取得

```
GET /api/members
```

**レスポンス例:**

```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "name": "山田太郎",
      "position": "エンジニア",
      "strengths": "技術力が高い",
      "weaknesses": "コミュニケーションが苦手",
      "growthPlan": "リーダーシップスキルの向上",
      "createdAt": "2023-04-01T00:00:00.000Z",
      "updatedAt": "2023-04-01T00:00:00.000Z"
    },
    ...
  ]
}
```

#### メンバー詳細の取得

```
GET /api/members/[id]
```

**パラメータ:**
- `id`: メンバーID

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "name": "山田太郎",
    "position": "エンジニア",
    "strengths": "技術力が高い",
    "weaknesses": "コミュニケーションが苦手",
    "growthPlan": "リーダーシップスキルの向上",
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-01T00:00:00.000Z"
  }
}
```

#### メンバーの作成

```
POST /api/members
```

**リクエストボディ:**

```json
{
  "name": "山田太郎",
  "position": "エンジニア",
  "strengths": "技術力が高い",
  "weaknesses": "コミュニケーションが苦手",
  "growthPlan": "リーダーシップスキルの向上"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "name": "山田太郎",
    "position": "エンジニア",
    "strengths": "技術力が高い",
    "weaknesses": "コミュニケーションが苦手",
    "growthPlan": "リーダーシップスキルの向上",
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-01T00:00:00.000Z"
  }
}
```

#### メンバーの更新

```
PATCH /api/members/[id]
```

**パラメータ:**
- `id`: メンバーID

**リクエストボディ:**

```json
{
  "name": "山田太郎",
  "position": "シニアエンジニア",
  "strengths": "技術力が高い、問題解決能力がある",
  "weaknesses": "コミュニケーションが苦手",
  "growthPlan": "リーダーシップスキルの向上"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "name": "山田太郎",
    "position": "シニアエンジニア",
    "strengths": "技術力が高い、問題解決能力がある",
    "weaknesses": "コミュニケーションが苦手",
    "growthPlan": "リーダーシップスキルの向上",
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-02T00:00:00.000Z"
  }
}
```

#### メンバーの削除

```
DELETE /api/members/[id]
```

**パラメータ:**
- `id`: メンバーID

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1"
  }
}
```

### 1on1記録管理

#### 1on1記録一覧の取得

```
GET /api/one-on-ones
```

**クエリパラメータ:**
- `memberId`: (任意) メンバーIDでフィルタリング

**レスポンス例:**

```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "memberId": "1",
      "date": "2023-04-01T00:00:00.000Z",
      "duration": 30,
      "content": "プロジェクトの進捗について話し合いました。",
      "aiAdvice": "...",
      "createdAt": "2023-04-01T00:00:00.000Z",
      "updatedAt": "2023-04-01T00:00:00.000Z"
    },
    ...
  ]
}
```

#### 1on1記録詳細の取得

```
GET /api/one-on-ones/[id]
```

**パラメータ:**
- `id`: 1on1記録ID

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "memberId": "1",
    "date": "2023-04-01T00:00:00.000Z",
    "duration": 30,
    "content": "プロジェクトの進捗について話し合いました。",
    "aiAdvice": "...",
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-01T00:00:00.000Z",
    "member": {
      "id": "1",
      "name": "山田太郎",
      "position": "エンジニア"
    }
  }
}
```

#### 1on1記録の作成

```
POST /api/one-on-ones
```

**リクエストボディ:**

```json
{
  "memberId": "1",
  "date": "2023-04-01T00:00:00.000Z",
  "duration": 30,
  "content": "プロジェクトの進捗について話し合いました。"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "memberId": "1",
    "date": "2023-04-01T00:00:00.000Z",
    "duration": 30,
    "content": "プロジェクトの進捗について話し合いました。",
    "aiAdvice": null,
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-01T00:00:00.000Z"
  }
}
```

#### 1on1記録の更新

```
PATCH /api/one-on-ones/[id]
```

**パラメータ:**
- `id`: 1on1記録ID

**リクエストボディ:**

```json
{
  "date": "2023-04-01T00:00:00.000Z",
  "duration": 45,
  "content": "プロジェクトの進捗について話し合い、次のステップを決定しました。"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "memberId": "1",
    "date": "2023-04-01T00:00:00.000Z",
    "duration": 45,
    "content": "プロジェクトの進捗について話し合い、次のステップを決定しました。",
    "aiAdvice": "...",
    "createdAt": "2023-04-01T00:00:00.000Z",
    "updatedAt": "2023-04-02T00:00:00.000Z"
  }
}
```

#### 1on1記録の削除

```
DELETE /api/one-on-ones/[id]
```

**パラメータ:**
- `id`: 1on1記録ID

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1"
  }
}
```

### 設定管理

#### 設定の取得

```
GET /api/settings
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "openaiApiKey": "sk-...",
    "aiModel": "gpt-4o",
    "updatedAt": "2023-04-01T00:00:00.000Z"
  }
}
```

#### 設定の更新

```
PATCH /api/settings
```

**リクエストボディ:**

```json
{
  "openaiApiKey": "sk-...",
  "aiModel": "gpt-4o"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "id": "1",
    "openaiApiKey": "sk-...",
    "aiModel": "gpt-4o",
    "updatedAt": "2023-04-02T00:00:00.000Z"
  }
}
```

### AI機能

#### AIアドバイスの取得

```
POST /api/ai/advice
```

**リクエストボディ:**

```json
{
  "oneOnOneId": "1"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "advice": "## 会話パターンの分析\n\n会話では一方通行のコミュニケーションが見られます。より双方向のコミュニケーションを心がけると効果的です。\n\n## コーチング観点\n\n質問よりも指示が多い傾向があります。「どうすれば解決できると思う？」など、考えを引き出す質問を増やすことで自主性を促せます。\n\n## 次回の質問候補\n\n1. 前回話し合ったプロジェクトの進捗はどうですか？\n2. チーム内での自分の役割についてどう考えていますか？\n3. 最近のチャレンジは何ですか？\n"
  }
}
```

#### マネジメントスタイル分析の取得

```
POST /api/ai/analysis
```

**リクエストボディ:**

```json
{
  "memberId": "1",
  "startDate": "2023-01-01T00:00:00.000Z",
  "endDate": "2023-12-31T00:00:00.000Z"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "analysis": "## マネジメントスタイル分析\n\n### SL理論に基づく分析\n\n- 指示的行動: 高 (75%)\n- 支援的行動: 中 (50%)\n\n主に「指導型（S2）」のマネジメントスタイルが見られます。\n\n### コーチング度合い\n\n- 質問の割合: 30%\n- 傾聴の度合い: 45%\n- 承認の度合い: 40%\n\nコーチングスキルの改善の余地があります。特に質問の割合を増やすことで、メンバーの自主性を引き出せる可能性があります。\n"
  }
}
```

#### 総合マネジメントスタイル分析の取得

```
POST /api/ai/overall-analysis
```

**リクエストボディ:**

```json
{
  "startDate": "2023-01-01T00:00:00.000Z",
  "endDate": "2023-12-31T00:00:00.000Z"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "analysis": "## 総合マネジメントスタイル分析\n\n### SL理論に基づく分析\n\n- 指示的行動: 中高 (65%)\n- 支援的行動: 中 (55%)\n\n全体的に「指導型（S2）」と「支援型（S3）」の間のスタイルが見られます。\n\n### コーチング度合い\n\n- 質問の割合: 35%\n- 傾聴の度合い: 50%\n- 承認の度合い: 45%\n\n中程度のコーチングスキルが見られます。メンバーによって適切なスタイルを使い分けられるよう、さらなる柔軟性の向上が推奨されます。\n"
  }
}
```

#### 次回質問リストの取得

```
POST /api/ai/questions
```

**リクエストボディ:**

```json
{
  "oneOnOneId": "1"
}
```

**レスポンス例:**

```json
{
  "success": true,
  "data": {
    "questions": "## 次回の質問候補\n\n### 業務関連\n1. 前回話し合ったプロジェクトの進捗はどうですか？\n2. 現在の作業で一番難しいと感じていることは何ですか？\n3. サポートが必要なことはありますか？\n\n### 成長関連\n1. 最近学んだことで印象に残っていることは何ですか？\n2. キャリアの次のステップについてどう考えていますか？\n3. スキルアップするために何か始めたいことはありますか？\n\n### チーム関連\n1. チームの雰囲気をどう感じていますか？\n2. 他のメンバーとの協力で上手くいっている点はありますか？\n3. チーム内でもっと改善できると思う点はありますか？\n"
  }
}
```

## エラーレスポンス例

```json
{
  "success": false,
  "error": {
    "code": 404,
    "message": "指定されたリソースが見つかりませんでした。"
  }
}
```

## OpenAI API関連エラー

OpenAI APIキーが設定されていない場合や、APIエラーが発生した場合:

```json
{
  "success": false,
  "error": {
    "code": 500,
    "message": "OpenAI APIとの通信に失敗しました。APIキーが正しく設定されているか確認してください。",
    "details": "..."
  }
}
``` 